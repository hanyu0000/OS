# eBPF学习笔记
---
# 介绍
eBPF（extened Berkeley Packet Filter）是一种内核技术，它允许开发人员在不修改内核代码的情况下运行特定的功能。

出于对更好的 Linux 跟踪工具的需求，eBPF 从 dtrace中汲取灵感，dtrace 是一种主要用于 Solaris 和 BSD 操作系统的动态跟踪工具。与 dtrace 不同，Linux 无法全面了解正在运行的系统，因为它仅限于系统调用、库调用和函数的特定框架。在Berkeley Packet Filter  (BPF)（一种使用内核 VM 编写打包过滤代码的工具）的基础上，一小群工程师开始扩展 BPF 后端以提供与 dtrace 类似的功能集。 eBPF 诞生了。2014 年随 Linux 3.18 首次限量发布，充分利用 eBPF 至少需要 Linux 4.4 以上版本。

eBPF 比起传统的 BPF 来说，传统的 BPF 只能用于网络过滤，而 eBPF 则可以用于更多的应用场景，包括网络监控、安全过滤和性能分析等。另外，eBPF 允许常规用户空间应用程序将要在 Linux 内核中执行的逻辑打包为字节码，当某些事件（称为挂钩）发生时，内核会调用 eBPF 程序。此类挂钩的示例包括系统调用、网络事件等。用于编写和调试 eBPF 程序的最流行的工具链称为 BPF 编译器集合 (BCC)，它基于 LLVM 和 CLang。

eBPF 有一些类似的工具。例如，SystemTap 是一种开源工具，可以帮助用户收集 Linux 内核的运行时数据。它通过动态加载内核模块来实现这一功能，类似于 eBPF。另外，DTrace 是一种动态跟踪和分析工具，可以用于收集系统的运行时数据，类似于 eBPF 和 SystemTap。

|工具|eBPF|SystemTap|DTrace|
|---|-----|--------|-------|
|定位 |内核技术，可用于多种应用场景 |内核模块 |动态跟踪和分析工具
|工作原理 |动态加载和执行无损编译过的代码 |动态加载内核模块 |动态插接分析器，通过 probe 获取数据并进行分析
|常见用途 |网络监控、安全过滤、性能分析等 |系统性能分析、故障诊断等 |系统性能分析、故障诊断等
|优点 |灵活、安全、可用于多种应用场景 |功能强大、可视化界面 |功能强大、高性能、支持多种编程语言
|缺点 |学习曲线高，安全性依赖于编译器的正确性 |学习曲线高，安全性依赖于内核模块的正确性 	|配置复杂，对系统性能影响较大

从上表可以看出，eBPF、SystemTap 和 DTrace 都是非常强大的工具，可以用于收集和分析系统的运行情况。

